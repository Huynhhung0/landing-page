<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/AugurWallet.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> AugurWallet.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">42.11% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>24/57</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">18.18% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>4/22</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">40% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>4/10</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">41.38% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>24/58</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">pragma solidity 0.5.15;
&nbsp;
import 'ROOT/libraries/Initializable.sol';
import 'ROOT/IAugurWallet.sol';
import 'ROOT/libraries/token/IERC20.sol';
import 'ROOT/libraries/token/IERC1155.sol';
import 'ROOT/reporting/IAffiliates.sol';
import 'ROOT/IAugurWalletRegistry.sol';
import 'ROOT/uniswap/interfaces/IUniswapV2Factory.sol';
import 'ROOT/uniswap/interfaces/IUniswapV2Pair.sol';
import 'ROOT/uniswap/interfaces/IWETH.sol';
import 'ROOT/libraries/math/SafeMathUint256.sol';
&nbsp;
&nbsp;
contract AugurWallet is Initializable, IAugurWallet {
    using SafeMathUint256  for uint256;
&nbsp;
    IAugurWalletRegistry public registry;
    mapping(address =&gt; bool) public authorizedProxies;
&nbsp;
    uint256 private constant MAX_APPROVAL_AMOUNT = 2 ** 256 - 1;
&nbsp;
    //keccak256("EIP712Domain(address verifyingContract)");
    bytes32 public constant DOMAIN_SEPARATOR_TYPEHASH = 0x035aff83d86937d35b32e04f0ddc6ff469290eef2f1b692d8a815c89404d4749;
&nbsp;
    //keccak256("AugurWalletMessage(bytes message)");
    bytes32 public constant MSG_TYPEHASH = 0xe0e790a7bae5fba0106cf286392dd87dfd6ec8631e5631988133e4470b9e7b0d;
&nbsp;
    // bytes4(keccak256("isValidSignature(bytes,bytes)")
    bytes4 constant internal EIP1271_MAGIC_VALUE = 0x20c13b0b;
&nbsp;
    address owner;
&nbsp;
    bytes32 public domainSeparator;
    IERC20 public cash;
&nbsp;
    function initialize(address _owner, address _referralAddress, bytes32 _fingerprint, address _augur, address _legacyRegistry, IERC20 _cash, IAffiliates _affiliates, IERC1155 _shareToken, address _createOrder, address _fillOrder, address _zeroXTrade) external beforeInitialized {
        endInitialization();
        domainSeparator = keccak256(abi.encode(DOMAIN_SEPARATOR_TYPEHASH, this));
        owner = _owner;
        registry = IAugurWalletRegistry(msg.sender);
        authorizedProxies[msg.sender] = true;
        authorizedProxies[_legacyRegistry] = true;
        cash = _cash;
&nbsp;
        _cash.approve(_augur, MAX_APPROVAL_AMOUNT);
&nbsp;
        _cash.approve(_createOrder, MAX_APPROVAL_AMOUNT);
        _shareToken.setApprovalForAll(_createOrder, true);
&nbsp;
        _cash.approve(_fillOrder, MAX_APPROVAL_AMOUNT);
        _shareToken.setApprovalForAll(_fillOrder, true);
&nbsp;
        _cash.approve(_zeroXTrade, MAX_APPROVAL_AMOUNT);
&nbsp;
        _affiliates.setFingerprint(_fingerprint);
&nbsp;
        <span class="missing-if-branch" title="if path not taken" >I</span>if (_referralAddress != address(0)) {
<span class="cstat-no" title="statement not covered" >            _affiliates.setReferrer(_referralAddress)</span>;
        }
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function transferCash(address _to, uint256 _amount) externa</span>l {
<span class="cstat-no" title="statement not covered" >        require(authorizedProxies[msg.sender])</span>;
<span class="cstat-no" title="statement not covered" >        cash.transfer(_to, _amount)</span>;
    }
&nbsp;
    function executeTransaction(address _to, bytes calldata _data, uint256 _value) external returns (bool) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(authorizedProxies[msg.sender]);
        (bool _didSucceed, bytes memory _resultData) = address(_to).call.value(_value)(_data);
        return _didSucceed;
    }
&nbsp;
    function addAuthorizedProxy(address _authorizedProxy) external returns (bool) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(msg.sender == owner || authorizedProxies[msg.sender] || msg.sender == address(this));
        authorizedProxies[_authorizedProxy] = true;
        return true;
    }
&nbsp;
    function removeAuthorizedProxy(address _authorizedProxy) external returns (bool) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(msg.sender == owner || authorizedProxies[msg.sender] || msg.sender == address(this));
        authorizedProxies[_authorizedProxy] = false;
        return true;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function withdrawAllFundsAsDai(address _destination, uint256 _minExchangeRateInDai) external payable returns (bool</span>) {
<span class="cstat-no" title="statement not covered" >        require(msg.sender == owner)</span>;
<span class="cstat-no" title="statement not covered" >        IUniswapV2Pair _ethExchange = registry.ethExchange();</span>
<span class="cstat-no" title="statement not covered" >        IWETH _weth = registry.WETH();</span>
<span class="cstat-no" title="statement not covered" >        bool _token0IsCash = registry.token0IsCash();</span>
<span class="cstat-no" title="statement not covered" >        uint256 _ethAmount = address(this).balance;</span>
<span class="cstat-no" title="statement not covered" >        (uint112 _reserve0, uint112 _reserve1, uint32 _blockTimestampLast) = _ethExchange.getReserves();</span>
<span class="cstat-no" title="statement not covered" >        uint256 _cashAmount = getAmountOut(_ethAmount, _token0IsCash ? _reserve1 : _reserve0, _token0IsCash ? _reserve0 : _reserve1);</span>
<span class="cstat-no" title="statement not covered" >        uint256 _exchangeRate = _cashAmount.mul(10**18).div(_ethAmount);</span>
<span class="cstat-no" title="statement not covered" >        require(_minExchangeRateInDai &lt;= _exchangeRate, "Exchange rate too low")</span>;
<span class="cstat-no" title="statement not covered" >        _weth.deposit.value(_ethAmount)</span>();
<span class="cstat-no" title="statement not covered" >        _weth.transfer(address(_ethExchange), _ethAmount)</span>;
<span class="cstat-no" title="statement not covered" >        _ethExchange.swap(_token0IsCash ? _cashAmount : 0, _token0IsCash ? 0 : _cashAmount, address(this), "")</span>;
<span class="cstat-no" title="statement not covered" >        cash.transfer(_destination, cash.balanceOf(address(this)))</span>;
<span class="cstat-no" title="statement not covered" >        return true;</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getAmountOut(uint amountIn, uint reserveIn, uint reserveOut) public pure returns (uint amountOut</span>) {
<span class="cstat-no" title="statement not covered" >        require(amountIn &gt; 0)</span>;
<span class="cstat-no" title="statement not covered" >        require(reserveIn &gt; 0 &amp;&amp; reserveOut &gt; 0)</span>;
<span class="cstat-no" title="statement not covered" >        uint amountInWithFee = amountIn.mul(997);</span>
<span class="cstat-no" title="statement not covered" >        uint numerator = amountInWithFee.mul(reserveOut);</span>
<span class="cstat-no" title="statement not covered" >        uint denominator = reserveIn.mul(1000).add(amountInWithFee);</span>
<span class="cstat-no" title="statement not covered" >        amountOut = numerator / denominator</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function isValidSignature(bytes calldata _data, bytes calldata _signature) external view returns (bytes4</span>) {
<span class="cstat-no" title="statement not covered" >        bytes32 _messageHash = getMessageHash(_data);</span>
<span class="cstat-no" title="statement not covered" >        require(_signature.length &gt;= 65, "Signature data length incorrect")</span>;
<span class="cstat-no" title="statement not covered" >        bytes32 _r;</span>
<span class="cstat-no" title="statement not covered" >        bytes32 _s;</span>
<span class="cstat-no" title="statement not covered" >        uint8 _v;</span>
<span class="cstat-no" title="statement not covered" >        bytes memory _sig = _signature;</span>
&nbsp;
        assembly {
            _r := mload(add(_sig, 32))
            _s := mload(add(_sig, 64))
            _v := and(mload(add(_sig, 65)), 255)
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        require(owner == ecrecover(keccak256(abi.encodePacked("\x19Ethereum Signed Message:\n32", _messageHash)), _v, _r, _s), "Invalid Signature")</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        return EIP1271_MAGIC_VALUE;</span>
    }
&nbsp;
    /// @dev Returns hash of a message that can be signed by the owner.
    /// @param _message Message that should be hashed
    /// @return Message hash.
<span class="fstat-no" title="function not covered" >    function getMessageHash(bytes memory _message) public view returns (bytes32</span>) {
<span class="cstat-no" title="statement not covered" >        bytes32 safeMessageHash = keccak256(abi.encode(MSG_TYPEHASH, keccak256(_message)));</span>
<span class="cstat-no" title="statement not covered" >        return keccak256(abi.encodePacked(byte(0x19), byte(0x01), domainSeparator, safeMessageHash));</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function () external payabl</span>e {}
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Tue Jun 16 2020 12:04:17 GMT-0700 (Pacific Daylight Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
