<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/reporting/InitialReporter.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">all files</a> / <a href="index.html">contracts/reporting/</a> InitialReporter.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">95.35% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>41/43</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">60% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>12/20</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">84.62% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>11/13</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">95.35% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>41/43</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">48×</span>
<span class="cline-any cline-yes">48×</span>
<span class="cline-any cline-yes">48×</span>
<span class="cline-any cline-yes">48×</span>
<span class="cline-any cline-yes">48×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">123×</span>
<span class="cline-any cline-yes">123×</span>
<span class="cline-any cline-yes">123×</span>
<span class="cline-any cline-yes">123×</span>
<span class="cline-any cline-yes">123×</span>
<span class="cline-any cline-yes">123×</span>
<span class="cline-any cline-yes">123×</span>
<span class="cline-any cline-yes">123×</span>
<span class="cline-any cline-yes">123×</span>
<span class="cline-any cline-yes">123×</span>
<span class="cline-any cline-yes">123×</span>
<span class="cline-any cline-yes">123×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1809×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">262×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">226×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">102×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">pragma solidity 0.5.15;
&nbsp;
import 'ROOT/libraries/Initializable.sol';
import 'ROOT/reporting/IInitialReporter.sol';
import 'ROOT/reporting/IMarket.sol';
import 'ROOT/reporting/BaseReportingParticipant.sol';
import 'ROOT/libraries/Ownable.sol';
import 'ROOT/IAugur.sol';
&nbsp;
&nbsp;
/**
 * @title Initial Reporter
 * @notice The bond used to encapsulate the initial report for a Market
 */
contract InitialReporter is Ownable, BaseReportingParticipant, Initializable, IInitialReporter {
    address private designatedReporter;
    address private actualReporter;
    uint256 private reportTimestamp;
&nbsp;
    function initialize(IAugur _augur, IMarket _market, address _designatedReporter) public beforeInitialized {
        endInitialization();
        augur = _augur;
        market = _market;
        reputationToken = market.getUniverse().getReputationToken();
        designatedReporter = _designatedReporter;
    }
&nbsp;
    /**
     * @notice Redeems ownership of this bond for the provided redeemer in exchange for owed REP
     * @dev The address argument is ignored. There is only ever one owner of this bond, but the signature needs to match Dispute Crowdsourcer's redeem for code simplicity
     * @return bool True
     */
    function redeem(address) public returns (bool) {
        bool _isDisavowed = isDisavowed();
        if (!_isDisavowed &amp;&amp; !market.isFinalized()) {
            market.finalize();
        }
        uint256 _repBalance = reputationToken.balanceOf(address(this));
        <span class="missing-if-branch" title="else path not taken" >E</span>require(reputationToken.transfer(owner, _repBalance));
        if (!_isDisavowed) {
            augur.logInitialReporterRedeemed(market.getUniverse(), owner, address(market), size, _repBalance, payoutNumerators);
        }
        return true;
    }
&nbsp;
    function report(address _reporter, bytes32 _payoutDistributionHash, uint256[] memory _payoutNumerators, uint256 _initialReportStake) public {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(IMarket(msg.sender) == market);
        <span class="missing-if-branch" title="else path not taken" >E</span>require(reportTimestamp == 0, "InitialReporter.report: Report has already been placed");
        uint256 _timestamp = augur.getTimestamp();
        bool _isDesignatedReporter = _reporter == getDesignatedReporter();
        bool _designatedReportingExpired = _timestamp &gt; market.getDesignatedReportingEndTime();
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_designatedReportingExpired || _isDesignatedReporter, "InitialReporter.report: Reporting time not started");
        actualReporter = _reporter;
        owner = _reporter;
        payoutDistributionHash = _payoutDistributionHash;
        reportTimestamp = _timestamp;
        payoutNumerators = _payoutNumerators;
        size = _initialReportStake;
    }
&nbsp;
    function returnRepFromDisavow() public {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(IMarket(msg.sender) == market);
        <span class="missing-if-branch" title="else path not taken" >E</span>require(reputationToken.transfer(owner, reputationToken.balanceOf(address(this))));
        reportTimestamp = 0;
    }
&nbsp;
    function migrateToNewUniverse(address _designatedReporter) public {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(IMarket(msg.sender) == market);
        designatedReporter = _designatedReporter;
        reputationToken = market.getUniverse().getReputationToken();
    }
&nbsp;
    /**
     * @notice Used in the event of the market forking. First forks this bond into the appropriate child universe and then redeems there.
     * @return bool True
     */
    function forkAndRedeem() public returns (bool) {
        <span class="missing-if-branch" title="else path not taken" >E</span>if (!isDisavowed()) {
            augur.logInitialReporterRedeemed(market.getUniverse(), owner, address(market), size, reputationToken.balanceOf(address(this)), payoutNumerators);
        }
        fork();
        redeem(msg.sender);
        return true;
    }
&nbsp;
    /**
     * @return The amount of REP currently staked in this bond
     */
    function getStake() public view returns (uint256) {
        return size;
    }
&nbsp;
    /**
     * @return The designated reporter for this market / bond
     */
    function getDesignatedReporter() public view returns (address) {
        return designatedReporter;
    }
&nbsp;
    /**
     * @return When the actual report was made if one was made
     */
<span class="fstat-no" title="function not covered" >    function getReportTimestamp() public view returns (uint256</span>) {
<span class="cstat-no" title="statement not covered" >        return reportTimestamp;</span>
    }
&nbsp;
    /**
     * @return Bool indicating if the report was made by the Designated Reporter
     */
    function designatedReporterShowed() public view returns (bool) {
        return actualReporter == designatedReporter;
    }
&nbsp;
    /**
     * @return The REP token associated with this bond
     */
<span class="fstat-no" title="function not covered" >    function getReputationToken() public view returns (IReputationToken</span>) {
<span class="cstat-no" title="statement not covered" >        return reputationToken;</span>
    }
&nbsp;
    /**
     * @return Bool indicating if the report was ultimately the finalzied payout
     */
    function initialReporterWasCorrect() public view returns (bool) {
        return payoutDistributionHash != bytes32(0) &amp;&amp; payoutDistributionHash == market.getWinningPayoutDistributionHash();
    }
&nbsp;
    function onTransferOwnership(address _owner, address _newOwner) internal {
        augur.logInitialReporterTransferred(market.getUniverse(), market, _owner, _newOwner);
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Tue Jun 16 2020 12:04:17 GMT-0700 (Pacific Daylight Time)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
